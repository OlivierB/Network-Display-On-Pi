function AjaxManager(t){this.alertContainer=$("#"+t)}function WebSocketManager(t){this.alertContainer=$("#"+t)}function DataDispatcher(t){this.websocketManagers=[],this.connections=[],this.serverAddress=t}function TextFormatter(){}function resize(){$(".slide-div").height(window.innerHeight-100),$("#screen-container").slidesjs.width=window.innerHeight,$(".height-half").height((window.innerHeight-100)/2),$(".height-full").height(window.innerHeight-100)}function BandwidthChart(t,e,a){if(this.id=t,this.dataLength=a,this.local_network=[],this.incoming=[],this.outcoming=[],this.global=[],e)for(var i=new Date,s=i.getTime()-1e3*this.dataLength,n=this.dataLength;n--;)i.setTime(s),this.updateChart(0,0,0,0,i),s+=1e3;this.chart=new CanvasJS.Chart(this.id,{title:{text:"Traffic",fontFamily:"ChampWoff",fontSize:30},toolTip:{shared:!0,content:"<span style='\"'color: {color};'\"'><strong>{name}</strong></span> {y} kB/s"},data:[{type:"splineArea",name:"Global",color:"rgba(100,128,210, 0.2)",showInLegend:!1,dataPoints:this.global},{type:"spline",name:"Local Network",dataPoints:this.local_network,showInLegend:!0,markerSize:0},{type:"spline",name:"Incoming",showInLegend:!0,dataPoints:this.incoming,markerSize:0},{type:"spline",name:"Outcoming",showInLegend:!0,dataPoints:this.outcoming,markerSize:0}],axisY:{title:"kB/s",titleFontFamily:"ChampWoff",titleFontWeight:"bold"}}),this.chart.render()}function BandwidthChartAjax(t){BandwidthChart.call(this,t,!1,-1),AjaxManager.call(this,t+"-alert")}function BandwidthText(t,e){this.id=t,this.container=$("#"+this.id),this.font_size=e}function BandwidthTextAjax(t,e){BandwidthText.call(this,t,e),AjaxManager.call(this,t+"-alert")}function BaseAlert(t,e){this.id=t,this.font_size=e,this.alertContainer=$("#"+this.id+"-alert"),this.container=$("#"+this.id),this.container.css("font-size",e+"px")}function StackedColumnChart(t,e){this.id=t,this.data=[],this.chart=new CanvasJS.Chart(this.id,{title:{text:e},axisY:{title:"Packet percentage"},data:this.data}),this.chart.render()}function StackedColumnChartAjax(t,e){AjaxManager.call(this,t+"-alert"),StackedColumnChart.call(this,t,e)}function DnsDisplayer(t){WebSocketManager.call(this,t+"-alert"),this.elems=[],this.busy=!1}function DnsDisplayerText(t,e,a){DnsDisplayer.call(this,t),this.container=$("#"+t),this.nbElemDisplayed=0,this.number_item_dns_list=e,this.container.css("font-size",a)}function BubbleDns(t,e,a,i,s,n,o,h){this.context=t,this.canvas_width=e,this.canvas_height=a,this.text=i,this.limitY=s,this.image=n,this.font_size=o,this.draw_bubble=h,this.moveX=0,this.context.font="bold "+this.font_size+"pt ChampWoff",this.context.textAlign="center",this.size=this.context.measureText(this.text).width+20,this.semi_size=this.size/2,this.x=Math.random()*(this.canvas_width-this.size)+this.semi_size,this.y=this.canvas_height+this.semi_size}function DnsDisplayerCanvas(t,e,a){DnsDisplayer.call(this,t),this.bubbles=[],this.id=t,this.font_size=e,this.draw_bubble=a,this.canvas=document.createElement("canvas"),this.resize(),document.getElementById(t).appendChild(this.canvas),$(window).resize(this.resize.bind(this)),this.context=this.canvas.getContext("2d"),this.images=[];var i=new Image;i.src="res/img/redBubble.png",this.images[0]=i,i=new Image,i.src="res/img/blueBubble.png",this.images[1]=i,i=new Image,i.src="res/img/greenBubble.png",this.images[2]=i,i=new Image,i.src="res/img/bubble.png",this.images[3]=i,i.onload=function(){this.busy=!1}.bind(this),this.bubbleSize=150,this.needRedraw=!1,window.requestAnimationFramePerso=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),this.animate()}function IpLocationMap(t){WebSocketManager.call(this,t+"-alert"),this.ips=[]}function IpLocationMapOffline(t,e,a){this.id=t,this.dither=e,this.opacity=a,IpLocationMap.call(this,t),this.canvas=document.createElement("canvas"),document.getElementById(t).appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.resize();var i=new Image;i.src="res/img/earth_bw.png",i.onload=function(){var t=this.canvas.width/this.canvas.height,e=i.width/i.height;e>t?(this.mapWidth=this.canvas.width,this.mapHeight=this.canvas.width/e,this.paddingHeight=(this.canvas.height-this.mapHeight)/2,this.paddingWidth=0):(this.mapHeight=this.canvas.height,this.mapWidth=this.canvas.height*e,this.paddingHeight=0,this.paddingWidth=(this.canvas.width-this.mapWidth)/2),this.context.drawImage(i,this.paddingWidth,this.paddingHeight,this.mapWidth,this.mapHeight)}.bind(this)}function IpLocationMapOnline(t,e,a){this.dither=e,this.opacity=a,IpLocationMap.call(this,t),this.map=L.map(t).setView([45.597889,-11.304932],2),L.tileLayer("http://{s}.tile.cloudmade.com/6b0ce74e6f434a7eb264a178d75f0458/997/256/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',maxZoom:18}).addTo(this.map)}function PercentCounterChart(t,e,a){this.speed=100|a,this.id=t,this.id_data=e,this.chart=$("#"+t),this.chart.easyPieChart({animate:this.speed}),this.container=$("#"+this.id+" span")}function ServerStat(t){WebSocketManager.call(this,t+"-alert"),this.charts=[]}function SummaryCanvas(t){this.id=t,AjaxManager.call(this,t+"-alert"),this.canvas=document.createElement("canvas"),this.resize(),document.getElementById(t).appendChild(this.canvas),$(window).resize(this.resize.bind(this)),this.context=this.canvas.getContext("2d"),this.minHeight=-1}function BandwidthChartWebsocket(t){WebSocketManager.call(this,t+"-alert"),BandwidthChart.call(this,t,!0,100)}function BandwidthTextWebsocket(t,e){BandwidthText.call(this,t,e),WebSocketManager.call(this,t+"-alert")}function BarChart(t,e){this.id=t,this.data=[],this.chart=new CanvasJS.Chart(this.id,{title:{text:e,fontFamily:"ChampWoff",fontSize:30},axisX:{interval:1,gridThickness:0,labelFontSize:10,labelFontWeight:"normal",labelFontFamily:"Lucida Sans Unicode",labelFontColor:"black"},axisY:{title:"Packet number"},data:[{type:"column",name:"protocol",dataPoints:this.data}]}),this.chart.render()}function BarChartWebsocket(t,e,a){WebSocketManager.call(this,t+"-alert"),BarChart.call(this,t,a),this.id=t,this.id_data=e,this.container=$("#"+this.id)}AjaxManager.prototype.connect=function(t,e,a){this.address=t,this.path=e,this.time=a,this.load()},AjaxManager.prototype.load=function(){$.ajax({type:"GET",url:this.path,async:!0,success:function(t){t=$.parseJSON(t),this.dataManager(t),setTimeout(this.load.bind(this),this.time)}.bind(this),error:function(){var t='<span class="alert">Cannot reach the page.</span>';this.alertContainer.html(t)}.bind(this)})},WebSocketManager.prototype.connect=function(t,e){t.register(this,e)},WebSocketManager.prototype.onopen=function(){this.alertContainer.html("")},WebSocketManager.prototype.onerror=function(t){console.log("websocket error "+t)},WebSocketManager.prototype.onmessage=function(t){this.dataManager(t)},WebSocketManager.prototype.onclose=function(){this.protocolNotSupported?this.alertContainer.html('<span class="alert">Disconnected from server. Protocol not supported.</span>'):this.alertContainer.html('<span class="alert">Disconnected from server. Next try in 5 seconds.</span>')},DataDispatcher.prototype.register=function(t,e){e in this.websocketManagers||(this.websocketManagers[e]=[],this.connectToProt(this.serverAddress,e)),this.websocketManagers[e].push(t)},DataDispatcher.prototype.connectToProt=function(t,e){var a=new WebSocket(t,e);a.onopen=function(){if(a.protocol==e){console.log("Main connexion"),this.protocolNotSupported=!1;for(var t=0,i=this.websocketManagers[e].length;i>t;t++)this.websocketManagers[e][t].onopen();this.connections.push(a)}else{for(var t=0,i=this.websocketManagers[e].length;i>t;t++)this.websocketManagers[e][t].protocolNotSupported=!0,this.protocolNotSupported=!0;a.close()}}.bind(this),a.onerror=function(t){for(var a=0,i=this.websocketManagers[e].length;i>a;a++)this.websocketManagers[e][a].onerror(t)}.bind(this),a.onmessage=function(t){for(var a=JSON.parse(t.data),i=0,s=this.websocketManagers[e].length;s>i;i++)this.websocketManagers[e][i].onmessage(a)}.bind(this),a.onclose=function(a){for(var i=0,s=this.websocketManagers[e].length;s>i;i++)this.websocketManagers[e][i].onclose(a);this.protocolNotSupported?console.log("Protocol Not Supported : "+e):setTimeout(function(){this.connectToProt(t,e)}.bind(this),5e3)}.bind(this)},"undefined"!=typeof App&&(dispatcher=new DataDispatcher(App.NDOPAddress)),TextFormatter.formatNumber=function(t){var e="kB";return t>1e4&&(t/=1024,e="MB",t>1e4&&(t/=1024,e="GB",t>1e4&&(t/=1024,e="TB"))),$.number(t)+" "+e},$(window).resize(function(){resize()}),$(function(){resize()}),BandwidthChart.prototype.updateChart=function(t,e,a,i,s){this.xVal=s?new Date(s):new Date;var n=t;this.local_network.push({x:this.xVal,y:n});var o=e;this.incoming.push({x:this.xVal,y:o});var h=a;this.outcoming.push({x:this.xVal,y:h});var r=i;this.global.push({x:this.xVal,y:r}),this.xVal++,this.outcoming.length>this.dataLength&&this.dataLength>0&&(this.local_network.shift(),this.incoming.shift(),this.outcoming.shift(),this.global.shift())},BandwidthChart.prototype.clean=function(){this.local_network.length=0,this.incoming.length=0,this.outcoming.length=0,this.global.length=0},BandwidthChart.prototype.refresh=function(){this.chart.render()},BandwidthChartAjax.prototype=Object.create(BandwidthChart.prototype),BandwidthChartAjax.prototype.connect=AjaxManager.prototype.connect,BandwidthChartAjax.prototype.load=AjaxManager.prototype.load,BandwidthChartAjax.prototype.dataManager=function(t){for(var e=0,a=t.length;a>e;e++){var i=t[e];this.updateChart(parseInt(i.local),parseInt(i.incoming),parseInt(i.outcoming),parseInt(i.global),i.date)}this.refresh(),this.clean()},BandwidthText.prototype.dataManager=function(t){var e;e=t.list?t.list:t;var a='<table style="font-size:'+this.font_size+"px;line-height:"+this.font_size+'px;"><thead><tr><th colspan="2">Total traffic</th></tr></thead>';a+='<tr><td>Global</td>  <td><span class="bandwidth-number">'+TextFormatter.formatNumber(e.Ko)+" </span></td></tr>",a+='<tr><td>Local</td>  <td><span class="bandwidth-number">'+TextFormatter.formatNumber(e.loc_Ko)+"  </span></td></tr>",a+='<tr><td>Incoming</td> <td><span class="bandwidth-number">'+TextFormatter.formatNumber(e.in_Ko)+"  </span></td></tr>",a+='<tr><td>Outcoming</td>  <td><span class="bandwidth-number">'+TextFormatter.formatNumber(e.out_Ko)+"  </span></td></tr>",this.container.html(a)},BandwidthTextAjax.prototype=Object.create(AjaxManager.prototype),BandwidthTextAjax.prototype.dataManager=BandwidthText.prototype.dataManager,BaseAlert.prototype.load=function(){$.ajax({type:"GET",url:this.url,async:!0,success:function(t){this.container.html(t),this.alertContainer.html("")}.bind(this),error:function(){var t='<span class="alert">Cannot reach the BASE page (Snort web page).</span>';this.alertContainer.html(t)}.bind(this)}),setTimeout(this.load.bind(this),this.timeout)},BaseAlert.prototype.connect=function(t,e,a){this.url=e,this.address=t,this.timeout=a,this.load()},StackedColumnChart.prototype.updateChart=function(t){this.data.length=0;for(var e=t.listProt,a=0;a<e.length;a++){var s=e[a];dataProt=[];var n=t.listValue.length;for(i=0;n>i;i++)dataProt.push({y:parseInt(t.listValue[i].value[s])||0,label:t.listValue[i].date});this.data.push({type:"stackedColumn100",name:s,showInLegend:"true",dataPoints:dataProt})}this.chart.render()},StackedColumnChartAjax.prototype=Object.create(AjaxManager.prototype),StackedColumnChartAjax.prototype.updateChart=StackedColumnChart.prototype.updateChart,StackedColumnChartAjax.prototype.dataManager=function(t){this.updateChart(t)},DnsDisplayer.prototype=Object.create(WebSocketManager.prototype),DnsDisplayer.prototype.dataManager=function(t){for(var e=t.list_dns_name.length;e--;)this.elems.length>0&&t.list_dns_name[e]==this.elems[this.elems.length-1].dnsName?this.elems[this.elems.length-1]={dnsName:this.elems[this.elems.length-1].dnsName,nb:this.elems[this.elems.length-1].nb+1}:this.elems.push({dnsName:t.list_dns_name[e],nb:1}),this.busy||this.addItem()},DnsDisplayerText.prototype=Object.create(DnsDisplayer.prototype),DnsDisplayerText.prototype.addItem=function(){this.elems.length>0?(this.busy=!0,str="<tr><td>"+this.elems[0].dnsName+"</td><td>"+this.elems[0].nb+"</td></tr>",$("#dns-table > tbody:first").prepend(str),this.elems.shift(),this.nbElemDisplayed<this.number_item_dns_list?this.nbElemDisplayed++:$("#dns-table tr:last").detach(),setTimeout(this.addItem.bind(this),1e3)):this.busy=!1},BubbleDns.prototype.display=function(){this.context.fillText(this.text,this.x+0,this.y+0),this.draw_bubble&&this.context.drawImage(this.image,this.x-this.semi_size,this.y-this.semi_size,this.size,this.size)},BubbleDns.prototype.update=function(){return this.y-=2,this.moveX+=(Math.random()-.5)/10,this.x+=this.moveX,this.limitY<this.y+this.size},DnsDisplayerCanvas.prototype=Object.create(DnsDisplayer.prototype),DnsDisplayerCanvas.prototype.addItem=function(){this.elems.length>0?(this.busy=!0,this.needRedraw||this.addBubble(this.elems[0].dnsName),this.needRedraw=!0,this.elems.shift(),setTimeout(this.addItem.bind(this),1e3)):this.busy=!1},DnsDisplayerCanvas.prototype.addBubble=function(t){var e=Math.floor(Math.random()*this.images.length),a=new BubbleDns(this.context,this.canvas.width,this.canvas.height,t,0,this.images[e],this.font_size,this.draw_bubble);this.bubbles.push(a)},DnsDisplayerCanvas.prototype.animate=function(){window.requestAnimationFramePerso(this.animate.bind(this)),this.render()},DnsDisplayerCanvas.prototype.render=function(){this.needRedraw=!1,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=this.bubbles.length;t--;)this.bubbles[t].update()?this.bubbles[t].display():(delete this.bubbles[t],this.bubbles.splice(t,1))},DnsDisplayerCanvas.prototype.resize=function(){this.canvas.width=$("#"+this.id).width(),this.canvas.height=$("#"+this.id).height()},IpLocationMap.prototype=Object.create(WebSocketManager.prototype),IpLocationMap.prototype.addPointFromIP=function(t,e){$.ajax({type:"GET",url:"http://"+App.freeGeoIpAdress+"/json/"+t,async:!0,success:function(t){this.addPoint(t.latitude,t.longitude,e)}.bind(this)})},IpLocationMap.prototype.dataManager=function(t){if(null!==t.iplist)for(var e=t.iplist.length;e--;){var a=t.iplist[e];a in this.ips||(this.addPointFromIP(a),this.ips[a]=1)}},IpLocationMapOffline.prototype=Object.create(IpLocationMap.prototype),IpLocationMapOffline.prototype.addPoint=function(t,e,a){a=a||"red";var i=this.mapWidth*(180+e)/360+this.paddingWidth,s=this.mapHeight*(90-t)/180+this.paddingHeight;i+=(Math.random()-.5)*this.dither,s+=(Math.random()-.5)*this.dither,this.drawCircle(i,s,3,a)},IpLocationMapOffline.prototype.drawCircle=function(t,e,a,i){this.context.globalAlpha=this.opacity,this.context.beginPath(),this.context.arc(t,e,a,0,2*Math.PI,!1),this.context.fillStyle=i,this.context.fill()},IpLocationMapOffline.prototype.resize=function(){this.canvas.width=$("#"+this.id).width(),this.canvas.height=$("#"+this.id).height()},IpLocationMapOnline.prototype=Object.create(IpLocationMap.prototype),IpLocationMapOnline.prototype.addPoint=function(t,e,a){a=a||"red",t+=(Math.random()-.5)*this.dither,e+=(Math.random()-.5)*this.dither,L.circle([t,e],100,{color:a,fillColor:a,fillOpacity:this.opacity}).addTo(this.map)},PercentCounterChart.prototype.updateChart=function(t){this.chart.data("easyPieChart").update(t),this.container.text(t.toFixed(2)+"%")},ServerStat.prototype=Object.create(WebSocketManager.prototype),ServerStat.prototype.dataManager=function(t){for(var e=this.charts.length;e--;){var a=this.charts[e];a.id_data in t&&a.updateChart(t[a.id_data])}},ServerStat.prototype.add=function(t,e,a){this.charts.push(new PercentCounterChart(t,e,a))},SummaryCanvas.prototype=Object.create(AjaxManager.prototype),SummaryCanvas.prototype.dataManager=function(t){this.save=t,this.drawFromData(t)},SummaryCanvas.prototype.drawFromData=function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var e=t.list;this.addBar(e.out_Ko,e.Ko,0,"rgb(69, 194, 197)"),this.addBar(e.in_Ko,e.Ko,1,"rgb(247, 141, 63)"),this.addBar(e.loc_Ko,e.Ko,2,"rgb(16, 46, 55)"),this.drawDate(t.date_begin),this.drawLegend()},SummaryCanvas.prototype.addBar=function(t,e,a,i){var s=t/e,n=1/6+.25*a,o=1/8+.5*(1-s),h=1/6,r=1*s/2+1/35;(-1==this.minHeight||this.minHeight>r)&&(this.minHeight=r),this.context.beginPath(),this.context.rect(this.ratioX(n),this.ratioY(o),this.ratioX(h),this.ratioY(r)),this.context.fillStyle=i,this.context.fill(),this.drawText(TextFormatter.formatNumber(t),this.ratioX(n+1/12),this.ratioY(o-1/35),i,this.ratioX(1/35),"")},SummaryCanvas.prototype.drawText=function(t,e,a,i,s,n){this.context.font=n+" "+s+"pt ChampWoff",this.context.fillStyle=i,this.context.textAlign="center",this.context.fillText(t,e,a)},SummaryCanvas.prototype.resize=function(){this.canvas.width=$("#"+this.id).width(),this.canvas.height=$("#"+this.id).height(),this.save&&(this.drawFromData(this.save),this.drawLegend())},SummaryCanvas.prototype.ratioX=function(t){return t*this.canvas.width},SummaryCanvas.prototype.ratioY=function(t){return t*this.canvas.height},SummaryCanvas.prototype.drawLegend=function(){var t=5/8+1/70,e="black",a="#9A9A9A";this.minHeight>-1&&this.minHeight<1/30*this.canvas.width/this.canvas.height+1/70&&(t+=1/30*this.canvas.width/this.canvas.height+1/70,a="black"),this.drawText("UP",this.ratioX(.25),this.ratioY(t),e,this.ratioX(1/30),"bold"),this.drawText("DOWN",this.ratioX(.5),this.ratioY(t),e,this.ratioX(1/30),"bold"),this.drawText("LOCAL",this.ratioX(.75),this.ratioY(t),a,this.ratioX(1/30),"bold")},SummaryCanvas.prototype.drawDate=function(t){var e=.75+1/30;this.drawText("Since "+t,this.ratioX(.25),this.ratioY(e),"black",this.ratioX(.025),"bold")},BandwidthChartWebsocket.prototype=Object.create(WebSocketManager.prototype),BandwidthChartWebsocket.prototype.dataManager=function(t){this.updateChart(t.loc_Ko,t.in_Ko,t.out_Ko,t.Ko),this.refresh()},BandwidthChartWebsocket.prototype.updateChart=BandwidthChart.prototype.updateChart,BandwidthChartWebsocket.prototype.refresh=BandwidthChart.prototype.refresh,BandwidthTextWebsocket.prototype=Object.create(WebSocketManager.prototype),BandwidthTextWebsocket.prototype.dataManager=BandwidthText.prototype.dataManager,BarChart.prototype.updateChart=function(t){this.data.length=0;for(var e=0;e<t.length;e++)this.data.push({y:t[e][1],label:t[e][0]});this.chart.render()},BarChartWebsocket.prototype=Object.create(WebSocketManager.prototype),BarChartWebsocket.prototype.updateChart=BarChart.prototype.updateChart,BarChartWebsocket.prototype.dataManager=function(t){this.updateChart(t[this.id_data])};